<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML to Figma</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 16px;
      box-sizing: border-box;
  overflow: hidden; /* allow inner panes to scroll instead */
  min-height: 0; /* fix flexbox overflow in WebKit */
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .title {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .editors {
      display: flex;
      flex: 1;
      gap: 16px;
      margin-bottom: 16px;
  min-height: 0; /* allow children to grow/shrink and scroll */
    }

    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  min-height: 0; /* important so CodeMirror can size/scroll */
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background-color: #f0f0f0;
      border-bottom: 1px solid #ddd;
    }

    .editor-title {
      font-size: 14px;
      font-weight: 500;
      margin: 0;
    }

    .editor {
      flex: 1;
      width: 100%;
      /* let parent control height via flex; allow scrolling if used directly */
      border: none;
      resize: none;
      padding: 12px;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      box-sizing: border-box;
      overflow: auto;
      min-height: 0;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .button {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: background-color 0.2s;
    }

    .primary-button {
      background-color: #18a0fb;
      color: white;
    }

    .primary-button:hover {
      background-color: #0d8ee9;
    }

    .secondary-button {
      background-color: #e0e0e0;
      color: #333;
    }

    .secondary-button:hover {
      background-color: #d0d0d0;
    }

    .status {
      font-size: 14px;
      color: #666;
    }

    .error {
      color: #e53935;
    }

    .success {
      color: #43a047;
    }

    .processing {
      color: #fb8c00;
    }

    /* CodeMirror styling */
    .CodeMirror {
      /* make CodeMirror fill the editor container */
      flex: 1;
      height: auto;
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      min-height: 0;
    }
    /* Ensure internal editor area scrolls when content overflows */
    .CodeMirror-scroll {
      overflow: auto !important;
    }
  </style>
  <!-- Include CodeMirror for better code editing -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">HTML to Figma</h1>
      <div class="status" id="status"></div>
    </div>

    <div class="editors">
      <div class="editor-container">
        <div class="editor-header">
          <h2 class="editor-title">HTML</h2>
        </div>
        <textarea id="html-editor" class="editor" placeholder="Enter your HTML here..."></textarea>
      </div>

      <div class="editor-container">
        <div class="editor-header">
          <h2 class="editor-title">CSS</h2>
        </div>
        <textarea id="css-editor" class="editor" placeholder="Enter your CSS here..."></textarea>
      </div>
    </div>

    <div class="footer">
      <button id="cancel-button" class="button secondary-button">Cancel</button>
      <button id="create-button" class="button primary-button">Create Design</button>
    </div>
  </div>

  <script>
    // Initialize CodeMirror for HTML editor
    const htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-editor'), {
      mode: 'htmlmixed',
      theme: 'monokai',
      lineNumbers: true,
      autoCloseTags: true,
      autoCloseBrackets: true,
      matchBrackets: true,
      indentUnit: 2,
      tabSize: 2,
      lineWrapping: true
    });

    // Initialize CodeMirror for CSS editor
    const cssEditor = CodeMirror.fromTextArea(document.getElementById('css-editor'), {
      mode: 'css',
      theme: 'monokai',
      lineNumbers: true,
      autoCloseBrackets: true,
      matchBrackets: true,
      indentUnit: 2,
      tabSize: 2,
      lineWrapping: true
    });

    // Set some default content for easier testing
    htmlEditor.setValue(`<h1>Hello Figma</h1>
<p>This is a paragraph of text.</p>
<div class="box">This is a styled div</div>
<p style="opacity: 0.5;">This paragraph has inline opacity</p>
<div class="transparent-box">This div has opacity from CSS</div>
    <div class="shadow-box">This div has a box shadow</div>
<p style="text-decoration: underline;">This text has inline underline</p>
<p style="text-decoration: line-through;">This text has inline strikethrough</p>
<p class="underlined">This text has CSS underline</p>
<p class="strikethrough">This text has CSS strikethrough</p>
<p class="loose-lines">This text uses a larger line-height to demonstrate spacing between lines.\nThis is the second line.</p>
<p class="spaced-letters">This text has wider letter spacing</p>
<p class="spaced-letters-em">This text uses em-based letter spacing</p>
<p>This text has <u>HTML underline</u> tag</p>
<p>This text has <s>HTML strikethrough</s> tag</p>
<p>This text has <span style="text-decoration: underline;">span with underline</span> in it</p>

<!-- Display property test cases -->
<h2>Display Property Tests</h2>
<div class="block-element">This is a block element</div>
<div class="inline-element">This is an inline element</div>
<div class="inline-element">This is another inline element</div>
<div class="flex-container">
  <div class="flex-item">Flex item 1</div>
  <div class="flex-item">Flex item 2</div>
  <div class="flex-item">Flex item 3</div>
</div>
<div class="hidden-element">This element should be hidden</div>`);

    cssEditor.setValue(`h1 {
  color: #ff0000;
  font-size: 32px;
  text-decoration: line-through;
}

p {
  color: #333333;
  font-size: 16px;
}

.box {
  background-color: #e0f7fa;
  border: 2px solid #00bcd4;
  border-radius: 8px;
  padding: 16px;
  width: 200px;
  height: 100px;
}

.transparent-box {
  background-color: #4caf50;
  color: white;
  padding: 16px;
  border-radius: 8px;
  width: 200px;
  opacity: 0.7;
}

.underlined {
  text-decoration: underline;
  color: #0000ff;
}

.strikethrough {
  text-decoration: line-through;
  color: #ff00ff;
}

.loose-lines {
  line-height: 180%;
}

.spaced-letters {
  letter-spacing: 2px;
}

.spaced-letters-em {
  letter-spacing: 0.15em;
}

.shadow-box {
  background-color: #ffffff;
  border-radius: 8px;
  padding: 16px;
  width: 220px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Display property styles */
.block-element {
  display: block;
  background-color: #ffeb3b;
  padding: 10px;
  border: 1px solid #ffc107;
  margin: 10px 0;
}

.inline-element {
  display: inline;
  background-color: #90caf9;
  padding: 5px;
  border: 1px solid #2196f3;
  margin: 0 5px;
}

.flex-container {
  display: flex;
  background-color: #f5f5f5;
  padding: 10px;
  border: 1px solid #e0e0e0;
  margin: 10px 0;
}

.flex-item {
  background-color: #ce93d8;
  padding: 10px;
  margin: 5px;
  border: 1px solid #9c27b0;
}

.hidden-element {
  display: none;
  background-color: #ef9a9a;
  padding: 10px;
  border: 1px solid #f44336;
}`);

    // Get UI elements
    const createButton = document.getElementById('create-button');
    const cancelButton = document.getElementById('cancel-button');
    const statusElement = document.getElementById('status');

    // Handle create button click
    createButton.addEventListener('click', () => {
      const html = htmlEditor.getValue();
      const css = cssEditor.getValue();

      if (!html.trim()) {
        setStatus('Please enter some HTML', 'error');
        return;
      }

      // Send message to the plugin code
      parent.postMessage({
        pluginMessage: {
          type: 'create-from-html',
          html,
          css
        }
      }, '*');

      setStatus('Processing...', 'processing');
    });

    // Handle cancel button click
    cancelButton.addEventListener('click', () => {
      parent.postMessage({
        pluginMessage: {
          type: 'cancel'
        }
      }, '*');
    });

    // Listen for messages from the plugin code
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;

      if (!message) return;

      if (message.type === 'processing') {
        setStatus('Processing...', 'processing');
      } else if (message.type === 'success') {
        setStatus('Design created successfully!', 'success');
      } else if (message.type === 'error') {
        setStatus(`Error: ${message.message}`, 'error');
      }
    };

    // Function to set status message
    function setStatus(message, type) {
      statusElement.textContent = message;
      statusElement.className = 'status';
      
      if (type) {
        statusElement.classList.add(type);
      }
    }
  </script>
</body>
</html>